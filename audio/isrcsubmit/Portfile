# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           python 1.0

name                isrcsubmit
version             2.1.0
revision            0

categories-prepend  audio devel
license             GPL-3+
platforms           {darwin any}
supported_archs     noarch

description         Utility to extract ISRCs from audio CDs and submit them to MusicBrainz
long_description    isrcsubmit is a Python script to extract ISRCs from audio CDs \
                    and submit them to MusicBrainz.

homepage            http://jonnyjd.github.io/musicbrainz-isrcsubmit/
master_sites        http://isrcsubmit.jonnyjd.net/downloads/

maintainers         nomaintainer

checksums           rmd160  5b7b7e3a8bfd4ff481a5da28fcbb7a8bcd6b8402 \
                    sha256  fe1078e332b09d259b87fb15959a143916bd31b09a37a54917a35cfb0fe6b3d6 \
                    size    50430

patchfiles-append   setup-no-packages.patch \
                    get_real_mac_device-bytes.patch

python.versions     39 310 311
python.pep517       no

depends_build-append \
                    port:py${python.version}-setuptools

depends_lib-append  port:py${python.version}-discid \
                    port:py${python.version}-musicbrainzngs \
                    port:py${python.version}-keyring

post-destroot {
    # fix shebang
    system -W ${destroot} \
        "sed -i '' -e '1s;^#!.*;#!${python.bin};' .${python.prefix}/bin/isrcsubmit.py"

    # remove .py suffix from installed executable
    move ${destroot}${prefix}/bin/isrcsubmit.py ${destroot}${prefix}/bin/isrcsubmit

    set dest_doc ${destroot}${prefix}/share/doc/${subport}
    xinstall -d ${dest_doc}
    xinstall -m 0644 -W ${worksrcpath} \
        AUTHORS COPYING README.rst \
        ${dest_doc}
}

test.run            yes

livecheck.url       https://jonnyjd.github.io/musicbrainz-isrcsubmit/changes
livecheck.type      regex
livecheck.regex     "Changes in (\[0-9.\]+)"
